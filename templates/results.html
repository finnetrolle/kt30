<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ - WBS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h1>
            <p class="subtitle">Work Breakdown Structure –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</p>
        </header>

        <nav class="breadcrumb">
            <a href="{{ url_for('index') }}">‚Üê –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</a>
        </nav>

        <main class="main-content results-page">
            <!-- Project Info Section -->
            <section class="result-section project-info-section">
                <h2>üìÅ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª:</span>
                        <span class="info-value">{{ filename }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:</span>
                        <span class="info-value">{{ timestamp }}</span>
                    </div>
                    {% if result.project_info %}
                    <div class="info-item">
                        <span class="info-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</span>
                        <span class="info-value">{{ result.project_info.project_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–û–ø–∏—Å–∞–Ω–∏–µ:</span>
                        <span class="info-value">{{ result.project_info.description or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–û—Ü–µ–Ω–æ—á–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                        <span class="info-value">{{ result.project_info.estimated_duration or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</span>
                        <span class="info-value complexity-{{ result.project_info.complexity_level | lower if result.project_info.complexity_level else 'unknown' }}">
                            {{ result.project_info.complexity_level or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}
                        </span>
                    </div>
                    {% endif %}
                </div>
            </section>

            <!-- WBS Phases Section -->
            {% if result.wbs and result.wbs.phases %}
            <section class="result-section wbs-section">
                <h2>üìã Work Breakdown Structure</h2>
                
                {% for phase in result.wbs.phases %}
                <div class="wbs-phase">
                    <div class="phase-header" onclick="togglePhase(this)">
                        <div class="phase-title">
                            <span class="phase-id">{{ phase.id }}</span>
                            <span class="phase-name">{{ phase.name }}</span>
                        </div>
                        <div class="phase-meta">
                            <span class="phase-duration">‚è±Ô∏è {{ phase.duration }} {% if phase.duration_days %}({{ phase.duration_days }} –¥–Ω.){% endif %}</span>
                            <span class="toggle-icon">‚ñº</span>
                        </div>
                    </div>
                    
                    <div class="phase-content">
                        <p class="phase-description">{{ phase.description }}</p>
                        
                        {% if phase.work_packages %}
                        <div class="work-packages">
                            {% for wp in phase.work_packages %}
                            <div class="work-package {% if wp.can_start_parallel %}parallel-work{% endif %}">
                                <div class="wp-header" onclick="toggleWorkPackage(this)">
                                    <div class="wp-title">
                                        <span class="wp-id">{{ wp.id }}</span>
                                        <span class="wp-name">{{ wp.name }}</span>
                                        {% if wp.can_start_parallel %}
                                        <span class="parallel-badge" title="–ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ">üîÑ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ</span>
                                        {% endif %}
                                    </div>
                                    <div class="wp-meta">
                                        <span class="wp-hours">üïê {{ wp.estimated_hours }} —á.</span>
                                        {% if wp.duration_days %}
                                        <span class="wp-duration">üìÖ {{ wp.duration_days }} –¥–Ω.</span>
                                        {% endif %}
                                        <span class="toggle-icon">‚ñº</span>
                                    </div>
                                </div>
                                
                                <div class="wp-content">
                                    <p class="wp-description">{{ wp.description }}</p>
                                    
                                    {% if wp.dependencies and wp.dependencies | length > 0 %}
                                    <div class="wp-dependencies">
                                        <strong>‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç:</strong>
                                        <span class="dependency-list">{{ wp.dependencies | join(', ') }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if wp.can_start_parallel %}
                                    <div class="parallel-info">
                                        <strong>‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong>
                                        <span>–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç —Ä–∞–±–æ—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ —Ç–æ–π –∂–µ —Ñ–∞–∑—ã</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if wp.deliverables %}
                                    <div class="wp-deliverables">
                                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</strong>
                                        <ul>
                                            {% for deliverable in wp.deliverables %}
                                            <li>{{ deliverable }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                    
                                    {% if wp.skills_required %}
                                    <div class="wp-skills">
                                        <strong>–¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏:</strong>
                                        <div class="skills-list">
                                            {% for skill in wp.skills_required %}
                                            <span class="skill-tag">{{ skill }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if wp.tasks %}
                                    <div class="tasks-list">
                                        <strong>–ó–∞–¥–∞—á–∏:</strong>
                                        {% for task in wp.tasks %}
                                        <div class="task-item {% if task.can_start_parallel %}parallel-task{% endif %}">
                                            <div class="task-header">
                                                <span class="task-id">{{ task.id }}</span>
                                                <span class="task-name">{{ task.name }}</span>
                                                <span class="task-hours">{{ task.estimated_hours }} —á.</span>
                                                {% if task.duration_days %}
                                                <span class="task-duration">{{ task.duration_days }} –¥–Ω.</span>
                                                {% endif %}
                                                {% if task.can_start_parallel %}
                                                <span class="parallel-mini-badge">üîÑ</span>
                                                {% endif %}
                                            </div>
                                            <p class="task-description">{{ task.description }}</p>
                                            {% if task.dependencies and task.dependencies | length > 0 %}
                                            <div class="task-dependencies">
                                                <small>‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: {{ task.dependencies | join(', ') }}</small>
                                            </div>
                                            {% endif %}
                                            {% if task.skills_required %}
                                            <div class="task-skills">
                                                <small>–ù–∞–≤—ã–∫–∏: {% for skill in task.skills_required %}<span class="skill-mini-tag">{{ skill }}</span> {% endfor %}</small>
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </section>
            
            <!-- Dependencies Matrix Section -->
            {% if result.dependencies_matrix %}
            <section class="result-section dependencies-section">
                <h2>üîó –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</h2>
                <div class="dependencies-info">
                    <p>–ù–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
                </div>
                <div class="dependencies-matrix">
                    <table class="deps-table">
                        <thead>
                            <tr>
                                <th>–ó–∞–¥–∞—á–∞</th>
                                <th>–ó–∞–≤–∏—Å–∏—Ç –æ—Ç</th>
                                <th>–ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dep in result.dependencies_matrix %}
                            <tr>
                                <td class="dep-task-id">{{ dep.task_id }}</td>
                                <td class="dep-deps">
                                    {% if dep.depends_on and dep.depends_on | length > 0 %}
                                    <span class="dep-item">{{ dep.depends_on | join(', ') }}</span>
                                    {% else %}
                                    <span class="no-deps">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td class="dep-parallel">
                                    {% if dep.parallel_with and dep.parallel_with | length > 0 %}
                                    <span class="parallel-item">{{ dep.parallel_with | join(', ') }}</span>
                                    {% else %}
                                    <span class="no-parallel">‚Äî</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}
            {% endif %}

            <!-- Risks Section -->
            {% if result.risks %}
            <section class="result-section risks-section">
                <h2>‚ö†Ô∏è –†–∏—Å–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞</h2>
                <div class="risks-grid">
                    {% for risk in result.risks %}
                    <div class="risk-card risk-{{ risk.probability | lower }}-{{ risk.impact | lower }}">
                        <div class="risk-header">
                            <span class="risk-id">{{ risk.id }}</span>
                            <span class="risk-probability">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: {{ risk.probability }}</span>
                            <span class="risk-impact">–í–ª–∏—è–Ω–∏–µ: {{ risk.impact }}</span>
                        </div>
                        <p class="risk-description">{{ risk.description }}</p>
                        <div class="risk-mitigation">
                            <strong>–ú–∏—Ç–∏–≥–∞—Ü–∏—è:</strong> {{ risk.mitigation }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Assumptions Section -->
            {% if result.assumptions %}
            <section class="result-section assumptions-section">
                <h2>üìù –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
                <ul class="assumptions-list">
                    {% for assumption in result.assumptions %}
                    <li>{{ assumption }}</li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}

            <!-- Recommendations Section -->
            {% if result.recommendations %}
            <section class="result-section recommendations-section">
                <h2>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
                <div class="recommendations-grid">
                    {% for rec in result.recommendations %}
                    <div class="recommendation-card priority-{{ rec.priority | lower }}">
                        <div class="rec-header">
                            <span class="rec-category">{{ rec.category }}</span>
                            <span class="rec-priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {{ rec.priority }}</span>
                        </div>
                        <p class="rec-text">{{ rec.recommendation }}</p>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Actions Section -->
            <section class="result-section actions-section">
                <h2>üì• –≠–∫—Å–ø–æ—Ä—Ç</h2>
                <div class="action-buttons">
                    <a href="{{ url_for('export_excel', result_id=result_id) }}" class="action-btn">
                        üìä –°–∫–∞—á–∞—Ç—å Excel
                    </a>
                    <button onclick="exportAsJSON()" class="action-btn">
                        üìÑ –°–∫–∞—á–∞—Ç—å JSON
                    </button>
                    <button onclick="window.print()" class="action-btn">
                        üñ®Ô∏è –ü–µ—á–∞—Ç—å
                    </button>
                    <a href="{{ url_for('index') }}" class="action-btn secondary">
                        ‚Üê –ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
                    </a>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>¬© 2024 Technical Specification Analyzer</p>
        </footer>
    </div>

    <script>
        // Pass the result data to JavaScript for export
        const analysisResult = {{ result | tojson | safe }};
    </script>
    <script src="{{ url_for('static', filename='js/results.js') }}"></script>
</body>
</html>
